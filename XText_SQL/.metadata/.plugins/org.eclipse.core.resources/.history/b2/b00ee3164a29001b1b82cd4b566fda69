grammar mydsl.MyDsl with org.eclipse.xtext.common.Terminals

generate myDsl "http://www.MyDsl.mydsl"
import "http://www.eclipse.org/emf/2002/Ecore" as ecore

Model:
	Element += Element*;
	
Element:
	CREATE | ALTER | INSERT | SELECT | DELETE | DROPTABLE | TRUNCATE | UPDATE |
	SELECTFUNCT | DATABASE | VariableDeclaration ;


SELECT:
	"SELECT" ("*" | (column+=[CD] ("," column+=[CD])*)* ) 
	x=FromAndWhereClauses
;

FromAndWhereClauses:
	"FROM" table=[TableName] 
	("WHERE" z+=WhereDec (("AND" | "OR") z+=WhereDec)* )?
;

WhereDec:
	(column+=[CD] sign=("="|"<"|"<="|">"|">="|"!="|"LIKE") rightOperand=(RightOperandOne | RightOperandTwo | RightOperandThree))
;

RightOperandOne:
	"#" name=ID "#"
;
RightOperandTwo:
	column+=[CD]
;
RightOperandThree:
	val = INT
;

DATABASE:
	"CREATE" "DATABASE" name=ID
;

CREATE:
	tables+=TableDeclaration+
;
	
TableDeclaration:
	// Create statement for the table generation
	"CREATE" "TABLE" table+=tableName "(" attributes+=(ColumnDeclaration | PrimaryKey | ForeignKey)+ 
		("," attributes+=(ColumnDeclaration | PrimaryKey | ForeignKey))*
	")"
;

tableName returns TableName:
	name=ID
;
	
ColumnDeclaration returns CD:
	name=ID type=DataStructureType notNull?=(NOTNULL)?
;

PrimaryKey returns PrimaryKey:
	"PRIMARY" "KEY" "(" 
		columnAsPK+=[CD] ("," columnAsPK+=[CD])*
	")"
;

ForeignKey returns ForeignKey:
	"FOREIGN" "KEY" "(" 
		columnAsFK+=[CD] ("," columnAsFK+=[CD])* ")" 
	"REFERENCES" foreignTable=[TableDeclaration] 
	"(" foreignColumns+=[CD] ("," foreignColumns+=[CD])* ")"
;

enum DataStructureType:
	VARCHAR="varchar" | CHAR="char" | DATE="date" | INT="int" | FLOAT="float" | TIME="time" | TEXT="text"
;

DROPTABLE:
	"DROP" "TABLE" table+=[TableName] ("," table+=[TableName])*
;

TRUNCATE:
	"TRUNCATE" "TABLE" table+=[TableName] ("," table+=[TableName])*
;

DELETE:
	"DELETE" x=FromAndWhereClauses
;

 
UPDATE:
	"UPDATE" table+=[TableName] "SET" sc+=SetClause ("," sc+=SetClause)* ("WHERE" z+=WhereDec (("AND" | "OR") z+=WhereDec)* )?
;

SetClause:
	(column+=[CD] "=" (("#" name=ID "#") | val = INT) ) 
;


ALTER:
 	"ALTER" "TABLE" table+=[TableName] addDropUpdate=(ALTERDROP| ALTERADD | ALTERUPDATE)
 ;
 
ALTERDROP:
 	"DROP" "COLUMN" column+=[CD]
 ;
 
ALTERADD:
 	"ADD" column+=[CD]
 ;

ALTERUPDATE:
 	"ALTER" "COLUMN" column+=[CD]
 ;
 

VariableDeclaration:
	"var" name=ID "=" value=INT
;

IntLiteral:
	val = INT
;

RealLiteral:
	val = REAL
;

IntVarExpression:
	var = [VariableDeclaration]
;

SELECTFUNCT:
 	CountFunction |
 	AvgFunction |
 	SumFunction |
 	MinFunction |
 	MaxFunction
 ;
 
 CountFunction:
 	"SELECT" "COUNT" "(" column+=[CD] ")" x=FromAndWhereClauses
 ;
 
 AvgFunction:
 	"SELECT" "AVG" "(" column+=[CD] ")" x=FromAndWhereClauses
 ;
 
 SumFunction:
 	"SELECT" "SUM" "(" column+=[CD] ")" x=FromAndWhereClauses
 ;
 
 MinFunction:
 	"SELECT" "MIN" "(" column+=[CD] ")" x=FromAndWhereClauses
 ;
 
 MaxFunction:
 	"SELECT" "MAX" "(" column+=[CD] ")" x=FromAndWhereClauses
 ;
	
	
	
	
	
	
	
	
	
	
	

SELECT: => SELECT1 | SELECT2;

SELECT1:
	"SELECT" instr += INSTRUCTION* 
	from += I_FROM
;

SELECT2:
	"SELECT" instr += INSTRUCTION* "AS"
	from += I_FROM
;
	
I_FROM: 
	"FROM" nameTable=ID ;

INSTRUCTION:
	nameC=ID","
;
INSERT:
	"INSERT""INTO" nameT=ID "VALUES" "(" (literals+=SLiteral)* ")" ;

SLiteral:
	typeINT; //| {SLiteral} STRING | {SLiteral} DOUBLE | {SLiteral} CHAR;


typeINT: integer | bigint | smallint;

smallint: {smallint} "smallint";
bigint: {bigint} "bigint";
integer: {integer} "int";

REAL returns ecore::EFloat hidden():
	INT? "." INT
;



	

terminal CHAR: "'" ID "'";
terminal NOTNULL: "not null";

